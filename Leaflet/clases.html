<html>
<head>
	    <title>AGILE2014</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="DC.Title" content="Página web para el Congreso AGILE2014">
    <meta name="description" content="Poner descripción aquí">
    <meta name="keywords" content="Poner keywords aquí">
    <meta name="Subject" content="Poner el subject aquí.">

    <!-- Funcionamiento parecido al de una aplicación nativa -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <!-- CSS y JS de Leaflet -->
    <link rel="stylesheet" href="leaflet-0.7.2/leaflet.css" />
    <script src="leaflet-0.7.2/leaflet.js"></script>

    <!--  Esri Leaflet -->
    <script src="leaflet-0.7.2/esri-leaflet.js"></script>

    <!-- JQuery -->
    <script src="jquery-2.1.1.min.js" type="text/javascript"></script>

    <!-- ArcGIS -->
    <link rel="stylesheet" href="http://js.arcgis.com/3.9/js/esri/css/esri.css">
    <script src="http://js.arcgis.com/3.9/"></script>

    <script src="dist/js/expandcollapse.js"></script>

    <!-- Versión compilada y comprimida del CSS de Bootstrap -->
    <link rel="stylesheet" href="dist/css/bootstrap.min.css">
    <link href="dist/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="dist/css/main.css" rel="stylesheet">
    

    <!-- Estilo de la página -->
    <style>
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
      }
      #map {
        width: 100%;
        height:100%;
        background-color: #b2b2b2;
      }

    </style>
</head>

<body>

	<div id="map"></div>
  <div id="map2"></div>

	<script type="text/javascript">
		var lat ,lon;
              function Aula(id) {

              	switch(id){

              	//	JAAS04CC - PLENARY ROOM
              	case "JAAS04CC":
            lat=39.994586;
            lon=-0.065949;
           this.codigo = "JAAS04CC";
           this.planta = "-1";
           this.descripcion = "PLENARY ROOM";
           this.latitud = -7352;
           this.longitud = 4865135;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
        };break;
        		//	JAA001CP - REGISTRATION, POSTERS & COFFE BREAKS
        		case "JAA001CP":
        	lat=39.994659;
            lon=-0.066684;
           this.codigo = "JAA001CP";
           this.planta = "0";
           this.descripcion = "REGISTRATION, POSTERS & COFFE BREAKS";
           this.latitud = -7353;
           this.longitud = 4865134;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;
				//	JB2101AA - PARALEL SESSION A
				case "JB2101AA":
			lat=39.994146;
            lon=-0.065479;
           this.codigo = "JB2101AA";
           this.planta = "1";
           this.descripcion = "PARALEL SESSION A";
           this.latitud = -7321;
           this.longitud = 4865119;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;
				//	JB1204AA - PARALEL SESSION B
				case "JB1204AA":
			lat=39.994508;
            lon=-0.065217;
           this.codigo = "JB1204AA";
           this.planta = "2";
           this.descripcion = "PARALEL SESSION B";
           this.latitud = -7302;
           this.longitud = 4865156;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;		
				//	JB2102AA - PARALEL SESSION C
				case "JB2102AA":
           this.codigo = "JB2102AA";
           this.planta = "1";
           this.descripcion = "PARALEL SESSION C";
           this.latitud = -7362;
           this.longitud = 4865189;
           this.imprime = function () {	
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;
				//	JAA006AI - LAB 1
				case "JAA006AI":
           this.codigo = "JAA006AI";
           this.planta = "0";
           this.descripcion = "LAB 1";
           this.latitud = -7335;
           this.longitud = 4865167;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;	
				//	JAA007AI - LAB 2
				case "JAA007AI":
           this.codigo = "JAA007AI";
           this.planta = "0";
           this.descripcion = "LAB 2";
           this.latitud = -7344;
           this.longitud = 4865174;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;
				//	JAA008AI - LAB 3
				case "JAA008AI":
           this.codigo = "JAA008AI";
           this.planta = "0";
           this.descripcion = "LAB 3";
           this.latitud = -7337;
           this.longitud = 4865185;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;
				//	JAAS01EC - CANTINA
				case "JAAS01EC":
           this.codigo = "JAAS01EC";
           this.planta = "-1";
           this.descripcion = "CANTINA";
           this.latitud = -7312;
           this.longitud = 4865165;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;
				//	JAA213FJ - MEETING ROOM
				case "JAA213FJ":
           this.codigo = "JAA213FJ";
           this.planta = "2";
           this.descripcion = "MEETING ROOM";
           this.latitud = -7341;
           this.longitud = 4865135;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;
				//	JB1005AA - WORKSHOP 1
				case "JB1005AA":
           this.codigo = "JB1005AA";
           this.planta = "0";
           this.descripcion = "WORKSHOP 1";
           this.latitud = -7356;
           this.longitud = 4865198;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;
				//	JB2005AA - WORKSHOP 2
				case "JB2005AA":
           this.codigo = "JB2005AA";
           this.planta = "0";
           this.descripcion = "WORKSHOP 2";
           this.latitud = -7264;
           this.longitud = 4865147;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;
				//	JAA207AA - WORKSHOP 3
				case "JAA207AA":
           this.codigo = "JAA207AA";
           this.planta = "2";
           this.descripcion = "WORKSHOP 3";
           this.latitud = -7324;
           this.longitud = 4865163;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;
				//	JAA206AA - WORKSHOP 4
				case "JAA206AA":
           this.codigo = "JAA206AA";
           this.planta = "2";
           this.descripcion = "WORKSHOP 4";
           this.latitud = -7318;
           this.longitud = 4865174;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;
				//	JB1206AA - WORKSHOP 5
				case "JB1206AA":
           this.codigo = "JB1206AA";
           this.planta = "2";
           this.descripcion = "WORKSHOP 5";
           this.latitud = -7385;
           this.longitud = 4865149;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;
				//	JB2205AA - WORKSHOP 6
				case "JB2205AA":
           this.codigo = "JB2205AA";
           this.planta = "2";
           this.descripcion = "WORKSHOP 6";
           this.latitud = -7287;
           this.longitud = 4865108;
           this.imprime = function () {
            return("Código: "+this.codigo+"</br>Planta: "+this.planta+"</br>Latitud: "+this.latitud+"</br>Longitud: "+this.longitud+"</br>Descripción:"+this.descripcion);
		};break;

		default: 
		alert("Aula inexistente");
		break;
	}

   };


	</script>


  <script type="text/javascript">//VARIABLES
      var urlMapaBase ="http://smartcampus.sg.uji.es:6080/arcgis/rest/services/SmartCampus/viscaUJI/MapServer";
      var urlMapServerAgile ="http://smartcampus.sg.uji.es:6080/arcgis/rest/services/AGILE/UJI_Agile/MapServer";
      var urlInteriores="http://smartcampus.sg.uji.es:6080/arcgis/rest/services/AGILE/BuildingInteriorbyFloorAgile/MapServer"

      var idaula =prompt("Introduce código de aula: ","JB2101AA");
      aula = new Aula(idaula);
      
      var capaBase = L.esri.dynamicMapLayer(urlMapaBase);
      var capaInteriores   = L.esri.dynamicMapLayer(urlInteriores);
      var capaAgile = L.esri.featureLayer(urlMapServerAgile+"/32");
      var capaAgile2 = L.esri.dynamicMapLayer(urlMapServerAgile);

      //var map = L.map('map').setView([lat, lon], 19);
      /*var map = L.map('map', {
        center: [lat, lon],
        zoom: 19
      });*/


  </script>

		<script type="text/javascript">//FUNCIONES

      function primeraCarga(){
        setTimeout(function(){
        añadirCapa(capaBase);}, 600);
        setTimeout(function(){
        añadirCapa(capaInteriores);}, 900);
        setTimeout(function(){
        añadirCapa(capaAgile);}, 2000);
        setTimeout(function(){
        var marker = L.marker([lat, lon]).addTo(map);
        marker.bindPopup(aula.imprime());}, 2000);
      }

      function añadirCapa(capa){
        map.addLayer(capa);
      }
      function borrarCapa(capa){
        map.removeLayer(capa);
      }      

      function accionEventos(){
          borrarCapa(capaAgile);
          borrarCapa(capaInteriores);
          borrarCapa(capaBase);
          
        setTimeout(function(){
          añadirCapa(capaBase);}, 1000);
        setTimeout(function(){
          añadirCapa(capaInteriores);}, 2000);
        setTimeout(function(){
          añadirCapa(capaAgile);}, 3000);
    }
          map.on('zoomstart', function() {
            /*borrarCapa(capaInteriores);
            borrarCapa(capaAgile);
             setTimeout(function(){
              primeraCarga();}, 200);*/
              //accionEventos();
                });

          map.on('dragend', function() {
            borrarCapa(capaInteriores);
            borrarCapa(capaAgile);
             setTimeout(function(){
              //primeraCarga();}, 200);
                });

      </script>

      <script type="text/javascript">//PUESTA EN MARCHA

      //primeraCarga();
     // var layersControl = new L.Control.Layers( {},{'Base':capaBase ,'Interiores':capaInteriores, 'Agile':capaAgile }).addTo(map);
      </script>
          <script>

          

      require([
        "esri/map",
        "esri/layers/ArcGISDynamicMapServiceLayer",
        "esri/layers/FeatureLayer",
        "esri/layers/ImageParameters",
        "esri/geometry/Point",
        "esri/geometry/webMercatorUtils",



      ], function (
        Map, ArcGISDynamicMapServiceLayer, FeatureLayer, ImageParameters, Point, webMercatorUtils) {


          

        var map2 = new Map("map",{
            //basemap:"topo",
            center: [lon, lat],
            scale: 800
        });

        

        
        var imageParameters = new ImageParameters();
        imageParameters.format = "jpeg"; //set the image type to PNG24, note default is PNG8.

        //Takes a URL to a non cached map service.
        var dynamicMapServiceLayer = new ArcGISDynamicMapServiceLayer("http://smartcampus.sg.uji.es:6080/arcgis/rest/services/SmartCampus/viscaUJI/MapServer");
        var dynamicMapServiceLayer2 = new ArcGISDynamicMapServiceLayer("http://smartcampus.sg.uji.es:6080/arcgis/rest/services/AGILE/BuildingInteriorbyFloorAgile/MapServer");
        var dynamicMapServiceLayer3 = new ArcGISDynamicMapServiceLayer("http://smartcampus.sg.uji.es:6080/arcgis/rest/services/AGILE/UJI_Agile/MapServer");

            var featureLayer = new FeatureLayer("http://smartcampus.sg.uji.es:6080/arcgis/rest/services/AGILE/UJI_Agile_rooms/MapServer/9",{
            mode: FeatureLayer.MODE_SNAPSHOT,opacity:0.9});
            var interioresEspacios = new FeatureLayer("http://smartcampus.sg.uji.es:6080/arcgis/rest/services/SmartCampus/BuildingInteriorbyFloor/MapServer/0",{
            mode: FeatureLayer.MODE_ONDEMAND});
                        var interioresLineas = new FeatureLayer("http://smartcampus.sg.uji.es:6080/arcgis/rest/services/SmartCampus/BuildingInteriorbyFloor/MapServer/1",{
            mode: FeatureLayer.MODE_ONDEMAND});
                        var featureLayer3 = new FeatureLayer("http://smartcampus.sg.uji.es:6080/arcgis/rest/services/AGILE/BuildingInteriorbyFloorAgile/MapServer/7",{
            mode: FeatureLayer.MODE_ONDEMAND});
        
        map2.addLayer(dynamicMapServiceLayer);
        //map2.addLayer(dynamicMapServiceLayer2)
        setTimeout(function(){
        map2.addLayer(dynamicMapServiceLayer2);
        },800);
        setTimeout(function(){
        map2.addLayer(interioresEspacios);
        },1000);
        setTimeout(function(){
        map2.addLayer(featureLayer);
        },1150);
        //map2.addLayer(dynamicMapServiceLayer3);

        añadirmarcador();
        var point, symbol, graphic, layer;

        function añadirmarcador(){
        point = new esri.geometry.Point(lon, lat);
        //point = esri.geometry.geographicToWebMercator(point);
        symbol = new esri.symbol.PictureMarkerSymbol("marcador.png", 50, 50);
        
        graphic = new esri.Graphic(point, symbol);
        
        layer = new esri.layers.GraphicsLayer();
          layer.add(graphic);
          map2.addLayer(layer);
          dojo.connect(layer, "onClick", onClick);
        }

        function borrarMarcador(){
          map2.removeLayer(layer);
        }
        

          function onClick() {
            alert(aula.imprime());
          }

          map2.on("zoom-start", function(){
          borrarMarcador();
        });
        map2.on("zoom-end",function(){
          añadirmarcador();
        })


     var popupTemplate = new esri.dijit.PopupTemplate({
        title: "{title}",
        description: "{description}"
      });




      });



    </script>


</body>

</html>